<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scanner Stok Barang</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #reader { width: 100%; max-width: 400px; margin: auto; }
    button { padding: 8px 12px; margin-top: 10px; cursor: pointer; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f2f2f2; }
  </style>
</head>
<body>

<h2>Scanner Stok Barang</h2>

<input type="text" id="barcodeInput" placeholder="Barcode" readonly><br>
<input type="text" id="namaBarangInput" placeholder="Nama Barang" readonly><br>
<input type="number" id="qtyInput" placeholder="Qty"><br>
<button onclick="startScanner()">Scan Barcode</button>
<button id="torchBtn" onclick="toggleTorch()" style="display:none;">Nyalakan Lampu</button>
<div id="reader" style="display:none;"></div>

<h3>Data Barang</h3>
<table id="dataTable">
  <thead>
    <tr>
      <th>Barcode</th>
      <th>Nama Barang</th>
      <th>Qty</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  let dataBarang = {
    "899999999001": "Sabun Mandi",
    "899999999002": "Shampoo Botol",
    "899999999003": "Pasta Gigi"
  };

  let scanner;
  let cameraId;
  let isTorchOn = false;

  function startScanner() {
    const readerDiv = document.getElementById("reader");
    readerDiv.style.display = "block";

    scanner = new Html5Qrcode("reader");

    Html5Qrcode.getCameras().then(cameras => {
      if (cameras && cameras.length) {
        cameraId = cameras[0].id;

        scanner.start(
          { deviceId: { exact: cameraId }, width: { ideal: 1280 }, height: { ideal: 720 } }, 
          { fps: 15, qrbox: { width: 350, height: 200 } },
          (decodedText) => {
            document.getElementById("barcodeInput").value = decodedText;
            const nama = dataBarang[decodedText];
            document.getElementById("namaBarangInput").value = nama || "Barang tidak ditemukan";
            addData(decodedText, nama || "Tidak ada", document.getElementById("qtyInput").value);
            scanner.stop().then(() => {
              readerDiv.innerHTML = "";
              readerDiv.style.display = "none";
              document.getElementById("torchBtn").style.display = "none";
            });
          },
          (errorMsg) => {}
        ).then(() => {
          document.getElementById("torchBtn").style.display = "block";
        });
      }
    }).catch(err => {
      alert("Gagal mengakses kamera: " + err);
    });
  }

  function toggleTorch() {
    isTorchOn = !isTorchOn;
    scanner.applyVideoConstraints({
      advanced: [{ torch: isTorchOn }]
    }).catch(err => {
      alert("Lampu tidak didukung di perangkat ini");
    });
    document.getElementById("torchBtn").innerText = isTorchOn ? "Matikan Lampu" : "Nyalakan Lampu";
  }

  function addData(barcode, nama, qty) {
    let tbody = document.querySelector("#dataTable tbody");
    let row = document.createElement("tr");
    row.innerHTML = `<td>${barcode}</td><td>${nama}</td><td>${qty}</td>`;
    tbody.appendChild(row);
    document.getElementById("qtyInput").value = "";
  }
</script>

</body>
</html>
